# @package _global_

defaults:
  - /benchmark/rearrange: rearrange_easy
  - /habitat_baselines: habitat_baselines_rl_config_base
  - /habitat_baselines/rl/policy/obs_transforms:
    - add_virtual_keys_base
  - /habitat/task/actions:
    - oracle_nav_action
    - arm_action
    - base_velocity
    - rearrange_stop
  - _self_

habitat:
  gym:
    auto_name: RearrangeEasy
    obs_keys:
      - robot_head_depth
      - relative_resting_position
      - obj_start_sensor
      - obj_goal_sensor
      - obj_start_gps_compass
      - obj_goal_gps_compass
      - joint
      - is_holding
      - localization_sensor

habitat_baselines:
  verbose: False
  trainer_name: "ddppo"
  torch_gpu_id: 0
  tensorboard_dir: "tb"
  video_dir: "video_dir"
  video_fps: 30
  video_render_views:
    - "third_rgb_sensor"
  test_episode_count: -1
  eval_ckpt_path_dir: ""
  num_environments: 1
  writer_type: 'tb'
  checkpoint_folder: "data/new_checkpoints"
  num_updates: -1
  total_num_steps: 1.0e8
  log_interval: 10
  num_checkpoints: 20
  force_torch_single_threaded: True
  eval_keys_to_include_in_name: ['reward', 'force', 'composite_success']
  load_resume_state_config: False
  eval:
    use_ckpt_config: False
    should_load_ckpt: False
    video_option: ["disk"]

  rl:
    policy:
        name: "HierarchicalPolicy"
        obs_transforms:
          add_virtual_keys:
            virtual_keys:
              "goal_to_agent_gps_compass": 2
        hierarchical_policy:
          high_level_policy:
            name: "FixedHighLevelPolicy"
            add_arm_rest: True
          defined_skills:
            open_cab:
              skill_name: "ArtObjSkillPolicy"
              name: "PointNavResNetPolicy"
              load_ckpt_file: "data/models/open_cab.pth"
              max_skill_steps: 200

            open_fridge:
              skill_name: "ArtObjSkillPolicy"
              load_ckpt_file: "data/models/open_fridge.pth"
              max_skill_steps: 200

            close_cab:
              skill_name: "ArtObjSkillPolicy"
              obs_skill_inputs: ["obj_start_sensor"]
              load_ckpt_file: "data/models/close_cab.pth"
              max_skill_steps: 200

            close_fridge:
              skill_name: "ArtObjSkillPolicy"
              obs_skill_inputs: ["obj_start_sensor"]
              load_ckpt_file: "data/models/close_fridge.pth"
              max_skill_steps: 200

            pick:
              skill_name: "PickSkillPolicy"
              name: "PointNavResNetPolicy"
              action_distribution_type: "gaussian"
              at_resting_threshold: 0.15
              obs_skill_inputs: ["obj_start_sensor"]
              load_ckpt_file: "data/models/pick.pth"
              max_skill_steps: 200

            place:
              skill_name: "PlaceSkillPolicy"
              name: "PointNavResNetPolicy"
              action_distribution_type: "gaussian"
              at_resting_threshold: 0.15
              obs_skill_inputs: ["obj_goal_sensor"]
              load_ckpt_file: "data/models/place.pth"
              max_skill_steps: 200

            wait_skill:
              skill_name: "WaitSkillPolicy"
              max_skill_steps: -1
              force_end_on_timeout: False

            gt_nav:
              skill_name: "OracleNavPolicy"
              obs_skill_inputs: ["obj_start_sensor", "abs_obj_start_sensor", "obj_goal_sensor", "abs_obj_goal_sensor"]
              max_skill_steps: 300

            reset_arm_skill:
              skill_name: "ResetArmSkill"
              max_skill_steps: 50
              reset_joint_state: [-4.5003259e-01, -1.0799699e00, 9.9526465e-02, 9.3869519e-01, -7.8854430e-04, 1.5702540e00, 4.6168058e-03]
              force_end_on_timeout: False

          use_skills:
            # Uncomment if you are also using these skills
            # open_cab: "open_cab"
            # open_fridge: "open_fridge"
            # close_cab: "open_cab"
            # close_fridge: "open_fridge"
            pick: "pick"
            place: "place"
            nav: "gt_nav"
            nav_to_receptacle: "gt_nav"
            wait: "wait_skill"
            reset_arm: "reset_arm_skill"

    ddppo:
      pretrained: False
      pretrained_encoder: False
      train_encoder: True
      reset_critic: False
